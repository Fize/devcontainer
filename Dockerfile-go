FROM tencentos/tencentos4-minimal:4.4-v20251020

ARG GO_VERSION=1.25.3

ENV GO_VERSION=${GO_VERSION} \
    PATH=/usr/local/go/bin:$PATH \
    GOPATH=/go

# 安装最小化系统包
RUN dnf update -y \
    && dnf install -y --setopt=install_weak_deps=False \
        ca-certificates \
        curl \
        git \
        make \
    && dnf clean all \
    && rm -rf /var/cache/dnf/*

# 安装 Go
RUN GO_ARCH=amd64 \
    && case "$(uname -m)" in \
        aarch64|arm64) GO_ARCH=arm64 ;; \
    esac \
    && curl -fsSL https://dl.google.com/go/go${GO_VERSION}.linux-${GO_ARCH}.tar.gz -o go.tar.gz \
    && curl -fsSL https://dl.google.com/go/go${GO_VERSION}.linux-${GO_ARCH}.tar.gz.sha256 -o go.tar.gz.sha256 \
    && SHA256_VALUE="$(tr -d '\n' < go.tar.gz.sha256)" \
    && printf "%s  %s\n" "${SHA256_VALUE}" go.tar.gz > go.tar.gz.sha256 \
    && sha256sum -c go.tar.gz.sha256 \
    && tar -C /usr/local -xzf go.tar.gz \
    && rm -f go.tar.gz go.tar.gz.sha256

# OCI Labels
LABEL org.opencontainers.image.title="devcontainer-go" \
      org.opencontainers.image.description="Go development container for TencentOS 4" \
      org.opencontainers.image.version.go="${GO_VERSION}" \
      org.opencontainers.image.base.name="tencentos/tencentos4-minimal:4.4-v20251020"

WORKDIR /workspace
CMD ["/bin/bash"]
